---
title: What's Mandatory Integrity Control?
---

<p>Mandatory Integrity Control (MIC) is a cool new security feature built in to Windows Vista and Windows Server 2008. It adds another &quot;layer&quot; of security to Windows resources (files, processes, etc.) over the usual DACL (Discretionary Access Control Lists) that we have in Windows XP and Windows Server 2003. </p>  <p>Essentially, Mandatory Integrity Control adds an &quot;Integrity Level&quot; to resources present in the Windows operating system. There are four possible integrity levels. They are (from most privileged to least privileged): System IL, High IL, Medium IL, and Low IL. System Services run at System IL, Administrative Processes run at High IL, and all resources in Windows with an explicitly set integrity level exist at Medium IL by default. When one resource wants access to another resource, the first resource's integrity level must be greater than or equal to the integrity level of the requested resource. This integrity level check takes place before we even check the DACLs on each resource.</p>  <p>Processes, for instance, can access files that have an integrity level lower than or equal to their own integrity level. So let's say I have Notepad running under my own local account (not an administrative account). By default, Notepad.exe is launched with an integrity level of Medium. As long as I am trying to write to a file that has an integrity level of Medium or below, then the operation will success just fine.</p>  <p>However, if I have a file that is sitting there with an integrity level of High, the write operation from Notepad will fail because Notepad doesn't have the proper integrity rights to access and to write to that resource.</p>  <p>Let's go ahead and take a look at this in action (you can work through this &quot;demo&quot; if you are currently running Windows Vista or Windows Server 2008).</p>  <p><strong>Demo</strong></p>  <p><i>You _must_ be running Vista and Windows Server 2008 for this demo to work</i></p>  <p>1) Launch Notepad</p>  <p>2) Enter some text and save the file as &#8220;test.txt&#8221; on your desktop. Now we have a text file with the default Medium IL.</p>  <p>3) Launch a command prompt as Administrator (from the shortcut, right click and choose &#8220;Run As Administrator&#8221;)</p>  <p>4) Navigate to your desktop (&#8220;cd C:\Users\USER_NAME\Desktop&#8221; in the command line for a default Vista installation).</p>  <p>5) Issue this command to set the created file&#8217;s integrity level to a High IL: &#8220;icacls test.txt /setintegritylevel H&#8221;. Now that the file has a high integrity level a default notepad process won&#8217;t be able to save the file.</p>  <p>6) Launch Notepad again (make sure it isn&#8217;t launched as Administrator since Administrator permissions will make it have an integrity level of High, voiding this experiment). </p>  <p>7) Open test.txt from your desktop</p>  <p>8) Change the file and try to save it. Notepad will fail while trying to save (Notepad gives a &#8220;user-friendly&#8221; error, but the underlying error is actually &#8220;Access Is Denies&#8221;). </p>  <p>There you have it, Mandatory Integrity Control in action! However, that's not the end to the story! </p>  <p><strong>Did You Know</strong>? Internet Explorer &#8220;Protected Mode&#8221; actually uses Mandatory Integrity Levels under the hood to achieve its goals. Since IE Protected Mode runs with a low integrity level, and all files on the file system (and running processes) are a medium integrity level by default, an attempt to write to those files or processes fails.</p><img src="http://blogs.msdn.com/aggbug.aspx?PostID=6154924" width="1" height="1">
